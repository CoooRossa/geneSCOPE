% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/1.CreateObj.r
\name{addCells}
\alias{addCells}
\title{Add Cell Count Matrix}
\usage{
addCells(coordObj, xenium_dir, verbose = TRUE)
}
\arguments{
\item{coordObj}{A valid \code{CoordObj} whose \code{@coord$centroids} slot
is already filled (e.g. via \code{\link{createCoordObj}}). Cells
found in this slot define the subset and order of columns kept.}

\item{xenium_dir}{Character scalar. Path to the Xenium \file{outs/}
directory that holds \file{cell_feature_matrix.h5}; must exist.}

\item{verbose}{Logical. Whether to print progress messages (default TRUE).}
}
\value{
The same object (modified in place) now carrying a
\code{dgCMatrix} in \code{@cells}.
}
\description{
Read the Xenium \strong{cell-feature sparse matrix} (either HDF5 or
Matrix-Market format), keep only the cells that appear in
\code{coordObj@coord$centroids$cell}, preserve that order, and store the
result in the new \code{@cells} slot.

The function relies only on \strong{Matrix}, \strong{data.table}, and
\strong{rhdf5} (or \strong{hdf5r})—no Seurat, tidyverse, or other heavy
dependencies.
}
\details{
The function performs four main steps:
\enumerate{
\item Reads the \strong{cell‑feature} matrix in HDF5 format produced by
10x Xenium, using \pkg{rhdf5} to avoid loading the full file into
memory.
\item Reconstructs the sparse count matrix as a \code{dgCMatrix} from
the \emph{x/i/p} components and automatically handles either
{genes × cells} or {cells × genes} orientations.
\item Filters and reorders columns so that their order matches the
centroid table (\code{coordObj@coord$centroids$cell}), guaranteeing
one‑to‑one correspondence for downstream spatial analyses.
\item Migrates any extra attributes found on the original matrix
(e.g. log-CPM transforms) into the list stored in
\code{coordObj@cells}.
}

Only the \pkg{Matrix}, \pkg{data.table}, and \pkg{rhdf5} packages are
required; no Seurat or tidyverse dependencies are introduced. Memory
footprint scales with the number of non‑zero entries, not the full matrix
dimensions.
}
\examples{
\dontrun{
## Add the cell‑level count matrix to an existing CoordObj
coord <- createCoordObj("mouse_brain/xenium_output")
coord <- addCells(coord, "mouse_brain/xenium_output")
}
}
