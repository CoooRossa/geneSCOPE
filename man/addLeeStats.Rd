% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/LeesL.r
\name{addLeeStats}
\alias{addLeeStats}
\title{Compute and Save Lee’s L Statistics with QC from Grid Data}
\usage{
addLeeStats(
  coordObj,
  grid_name = NULL,
  genes = NULL,
  within = TRUE,
  ncore = 1,
  perms = 0,
  L_min = 0.15,
  use_cpp = TRUE,
  norm_layer = "Xz",
  lee_stats_layer_name = NULL
)
}
\arguments{
\item{coordObj}{A coordObj processed through createCoordObj + norMPG
(or equivalent layers) + computeSpatialWeights.}

\item{grid_name}{Character or NULL. The name of the grid sublayer to use (e.g., "grid_lenGrid50").
If NULL and there is only one sublayer under coordObj\$grid, that layer is used;
otherwise this must be provided explicitly.}

\item{genes}{Character vector or NULL. If non-NULL, compute Lee’s L only for these genes:
- If within = TRUE, returns a |genes|×|genes| submatrix.
- If within = FALSE, returns a |genes|×|all genes| matrix.}

\item{within}{Logical (default TRUE):
- TRUE: compute Lee’s L within the provided genes list (|genes|×|genes|).
- FALSE: compute Lee’s L between the provided genes list and all genes (|genes|×|all genes|).}

\item{ncore}{Integer. Number of parallel cores to use when use_cpp = FALSE.}

\item{perms}{Integer. Number of Monte-Carlo permutations to perform for significance testing.}

\item{L_min}{Numeric. Minimum Lee’s L value to consider for QC metrics (default 0.15).}

\item{use_cpp}{Logical (default TRUE). Whether to call the C++ interface for acceleration.}

\item{norm_layer}{Character or NULL. The name of the normalization layer to use:
- If "Xz", reads coordObj\$grid[\link{grid_name}][\link{"Xz"}], which is already Z-score normalized
(column means ≈ 0).
- If NULL, uses the raw counts layer and applies column-centered normalization.}

\item{lee_stats_layer_name}{Character or NULL. If provided, the results will be saved under this name;}
}
\value{
The modified \code{coordObj}, with a new entry:
- \code{coordObj@grid[[grid_name]][[lee_stats_layer_name]]}: a list containing:
- \code{L}: Lee’s L submatrix (if within = TRUE, a |genes|×|genes| matrix; otherwise |genes|×|all genes|).
- \code{Z}: Analytical Z-score matrix (same dimensions as L).
- \code{P}: Permutation p-values matrix (same dimensions as L, NA if perms = 0).
- \code{FDR}: BH-adjusted p-values matrix (same dimensions as L).
- \code{betas}: Spatial gradient coefficients (|genes|×2 matrix, columns = beta_x, beta_y).
- \code{qc}: QC metrics list (if within = TRUE or genes is NULL, contains edge_density, components, modularity_Q,
mean_degree, sd_degree, hub_ratio, sig_edge_frac; otherwise NULL).
}
\description{
This function computes Lee’s L statistics for a given grid layer in a coordObj,
using either a column-centered or Z-score–normalized matrix.
It saves the results as a new layer in coordObj@grid[\link{grid_name}].
}
