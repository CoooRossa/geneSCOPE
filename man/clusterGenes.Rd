% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ClusterGene.r
\name{clusterGenes}
\alias{clusterGenes}
\title{Gene macro‑module clustering on Lee's \emph{L} with optional Inter/Intra filter}
\usage{
clusterGenes(
  coordObj,
  grid_name = NULL,
  lee_stats_layer = "LeeStats_Xz",
  L_min = 0,
  use_FDR = TRUE,
  FDR_max = 0.05,
  drop_isolated = TRUE,
  algo = c("louvain", "leiden"),
  resolution = 1,
  pct_min = "q0",
  filter_by_delta_class = TRUE,
  delta_layer = "LeeMinusR_bycell_stats",
  cluster_by_delta_class = c("Other", "Inter", "Intra"),
  cluster_name = NULL
)
}
\arguments{
\item{coordObj}{A \strong{CoordObj} returned by FG²CLI helpers.}

\item{grid_name}{Name of the grid sub‑layer.  If \code{NULL} and only a
single grid layer exists, that layer is used
automatically.}

\item{lee_stats_layer}{List entry storing Lee's \emph{L} results
(default "LeeStats_Xz").  Must contain matrices
\code{$L} and (optionally) \code{$FDR}.}

\item{L_min}{Minimum absolute Lee's \emph{L} for an edge to be kept
(default 0).}

\item{use_FDR}{Apply FDR filter (\code{FDR_max}) on \eqn{L} edges?
(default \code{TRUE}).}

\item{FDR_max}{Maximum FDR allowed when \code{use_FDR = TRUE}
(default 0.05).}

\item{drop_isolated}{Drop genes without any retained positive edge
(default \code{TRUE}).}

\item{algo}{Community algorithm: "louvain" (default) or "leiden".}

\item{resolution}{Leiden resolution parameter (ignored for Louvain).}

\item{pct_min}{Quantile filter to drop weakest positive edges before
graph construction; pass "q0" to disable.}

\item{delta_layer}{Name of the list entry that stores the \code{class}
matrix (default "LeeMinusR_bycell_stats").  Must
contain a character matrix \code{$class} with the same
dimnames as \code{$L}.}

\item{cluster_by_delta_class}{One of "none" (default), "Inter", or "Intra".
When set to "Inter" or "Intra", only edges labelled as
“Inter‑cellular” or “Intra‑cellular” in the class
matrix are retained before further filtering.}

\item{cluster_name}{Column name for the macro‑module IDs; a sensible
default is generated from \code{L_min} and the chosen
Inter/Intra filter.}
}
\value{
The modified \code{CoordObj} (invisibly).
}
\description{
Clusters genes into \strong{macro‑modules} using an undirected graph built from
positive Lee's \emph{L} edges.  Three sequential filters are applied to the
\eqn{L} matrix:

\enumerate{
\item \strong{Inter/Intra class mask} — If \code{cluster_by_delta_class} is set
to "Inter" or "Intra", all edges whose corresponding entry in the
\code{class} matrix (taken from \code{delta_layer}) is \emph{not}
“Inter‑cellular” or “Intra‑cellular” respectively are zeroed out.
\item \strong{Hard threshold} — Edges with \eqn{|L| < L_min} are removed; if
\code{use_FDR = TRUE}, edges with \code{FDR > FDR_max} are also
removed.
\item \strong{Quantile filter} — Optionally drop the weakest positive edges by
calling \code{.filter_matrix_by_quantile()}.
}

The remaining positive edges define a weighted undirected graph that is
partitioned by Louvain (default) or Leiden community detection.  Resulting
cluster IDs are stored in \code{coordObj@meta.data[[cluster_name]]}.  No
further sub‑clustering is performed.
}
