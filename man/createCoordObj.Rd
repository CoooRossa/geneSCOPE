% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/1.CreateObj.r
\name{createCoordObj}
\alias{createCoordObj}
\title{Build CoordObj from Xenium Output with (Multi-)Scale Grid Aggregation - FIXED}
\usage{
createCoordObj(
  xenium_dir,
  lenGrid,
  seg_type = c("cell", "nucleus", "both"),
  filtergenes = NULL,
  max_dist_mol_nuc = 25,
  filtermolecule = TRUE,
  exclude_prefix = c("Unassigned", "NegControl", "Background", "DeprecatedCodeword"),
  filterqv = 20,
  coord_file = NULL,
  ncores = 1L,
  chunk_pts = 5e+05,
  min_gene_types = 1,
  max_gene_types = Inf,
  min_seg_points = 1,
  keep_partial_grid = FALSE,
  verbose = TRUE,
  flip_y = TRUE
)
}
\arguments{
\item{xenium_dir}{Character. Path to the Xenium output directory.}

\item{lenGrid}{Numeric vector. Grid sizes for multi-resolution analysis.}

\item{seg_type}{Character. One of "cell", "nucleus", or "both". Type of segmentation to process.}

\item{filtergenes}{Character vector or NULL. Gene names to include (default NULL keeps all).}

\item{max_dist_mol_nuc}{Numeric. Maximum distance between molecule and nucleus for filtering (default 25).}

\item{filtermolecule}{Logical. Whether to filter molecules by prefix exclusion (default TRUE).}

\item{exclude_prefix}{Character vector. Prefixes to exclude when filtermolecule=TRUE (default c("Unassigned", "NegControl", "Background")).}

\item{filterqv}{Numeric or NULL. Minimum QV score for molecules (default 20).}

\item{coord_file}{Character or NULL. Path to CSV/TSV file defining ROI polygon coordinates.}

\item{ncores}{Integer. Number of cores for parallel processing (default 1L).}

\item{chunk_pts}{Numeric. Number of points to process per chunk (default 5e5).}

\item{min_gene_types}{Integer. Minimum number of unique genes per grid cell (default 1).}

\item{max_gene_types}{Numeric. Maximum number of unique genes per grid cell (default Inf).}

\item{min_seg_points}{Integer. Minimum number of segmentation points per grid cell (default 1).}

\item{keep_partial_grid}{Logical. Whether to keep incomplete edge grid cells (default FALSE).}

\item{verbose}{Logical. Whether to print progress messages (default TRUE).}

\item{flip_y}{Logical. Whether to flip Y coordinates (default TRUE).}
}
\value{
A CoordObj S4 object containing centroids, segmentation data, and multi-scale grid layers.
}
\description{
Fixes Y-axis flipping issue that caused misalignment between grid heatmap and segmentation:
(1) Flip only once; (2) After flip, grid origin y0 = 0; (3) Remove secondary flip inside build_grid.
All other parameters and return values remain identical to the previous version.
}
\details{
1.CreateObj_fixed.r (2025-07-09)

This function completely resolves the Y-axis flipping misalignment between grids and segmentation,
fixes segmentation filtering bugs that incorrectly removed all grids,
and corrects setenv errors when restoring environment variables.
All other parameters remain consistent with the previous version.
}
