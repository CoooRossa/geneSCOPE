% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/1.CreateObj.r
\name{createSCOPE}
\alias{createSCOPE}
\title{Build scope_object from Xenium Output with (Multi-)Scale Grid Aggregation}
\usage{
createSCOPE(
  xenium_dir,
  grid_length,
  seg_type = c("cell", "nucleus", "both"),
  filter_genes = NULL,
  max_dist_mol_nuc = 25,
  filtermolecule = TRUE,
  exclude_prefix = c("Unassigned", "NegControl", "Background", "DeprecatedCodeword"),
  filterqv = 20,
  coord_file = NULL,
  ncores = 1L,
  chunk_pts = 5e+05,
  min_gene_types = 1,
  max_gene_types = Inf,
  min_seg_points = 1,
  keep_partial_grid = FALSE,
  verbose = TRUE,
  flip_y = TRUE
)
}
\arguments{
\item{xenium_dir}{Character. Path to the Xenium output directory.}

\item{grid_length}{Numeric vector. Grid sizes for multi-resolution analysis.}

\item{seg_type}{Character. One of "cell", "nucleus", or "both". Type of segmentation to process.}

\item{filter_genes}{Character vector or NULL. Gene names to include (default NULL keeps all).}

\item{max_dist_mol_nuc}{Numeric. Maximum distance between molecule and nucleus for filtering (default 25).}

\item{filtermolecule}{Logical. Whether to filter molecules by prefix exclusion (default TRUE).}

\item{exclude_prefix}{Character vector. Prefixes to exclude when filtermolecule=TRUE (default c("Unassigned", "NegControl", "Background", "DeprecatedCodeword")).}

\item{filterqv}{Numeric or NULL. Minimum QV score for molecules (default 20).}

\item{coord_file}{Character or NULL. Path to CSV/TSV file defining ROI polygon coordinates.}

\item{ncores}{Integer. Number of cores for parallel processing (default 1L).}

\item{chunk_pts}{Numeric. Number of points to process per chunk (default 5e5).}

\item{min_gene_types}{Integer. Minimum number of unique genes per grid cell (default 1).}

\item{max_gene_types}{Numeric. Maximum number of unique genes per grid cell (default Inf).}

\item{min_seg_points}{Integer. Minimum number of segmentation points per grid cell (default 1).}

\item{keep_partial_grid}{Logical. Whether to keep incomplete edge grid cells (default FALSE).}

\item{verbose}{Logical. Whether to print progress messages (default TRUE).}

\item{flip_y}{Logical. Whether to flip Y coordinates (default TRUE).}
}
\value{
A scope_object S4 object containing centroids, segmentation data, and multi-scale grid layers.
}
\description{
Creates a scope_object from Xenium spatial transcriptomics data with multi-resolution grid aggregation.
Fixes Y-axis flipping issue that caused misalignment between grid heatmap and segmentation.
}
\details{
This function completely resolves the Y-axis flipping misalignment between grids and segmentation,
fixes segmentation filtering bugs that incorrectly removed all grids,
and corrects setenv errors when restoring environment variables.
All parameters remain consistent with the previous version.
}
\examples{
# Basic usage with default parameters
scope_obj <- createSCOPE(
  xenium_dir = "/path/to/xenium/output",
  grid_length = c(10, 25, 50)
)

# Advanced usage with filtering and ROI
scope_obj <- createSCOPE(
  xenium_dir = "/path/to/xenium/output", 
  grid_length = c(10, 25, 50),
  seg_type = "cell",
  filter_genes = c("Gene1", "Gene2", "Gene3"),
  coord_file = "/path/to/roi_coordinates.csv",
  ncores = 4L,
  verbose = TRUE
)
}
