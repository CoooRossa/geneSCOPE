% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/internal_clustering.R
\name{.cluster_genes}
\alias{.cluster_genes}
\title{Cluster genes on a consensus graph}
\usage{
.cluster_genes(
  scope_obj,
  grid_name = NULL,
  stats_layer = "LeeStats_Xz",
  lee_stats_layer = NULL,
  similarity_slot = "L",
  significance_slot = "FDR",
  min_cutoff = 0,
  L_min = NULL,
  use_significance = TRUE,
  use_FDR = NULL,
  significance_max = 0.05,
  FDR_max = NULL,
  pct_min = "q0",
  drop_isolated = TRUE,
  algo = c("leiden", "louvain", "hotspot-like"),
  stage2_algo = NULL,
  resolution = 1,
  gamma = 1,
  objective = c("CPM", "modularity"),
  cluster_name = NULL,
  use_log1p_weight = TRUE,
  use_consensus = TRUE,
  graph_slot_name = "g_consensus",
  n_restart = 100,
  consensus_thr = 0.95,
  K = NULL,
  min_module_size = 5,
  CI95_filter = NULL,
  CI_rule = NULL,
  curve_layer = NULL,
  use_mh_weight = NULL,
  use_cmh_weight = NULL,
  mh_slot = NULL,
  cmh_slot = NULL,
  post_smooth = TRUE,
  post_smooth_quant = c(0.05, 0.95),
  post_smooth_power = 0.5,
  enable_subcluster = TRUE,
  sub_min_size = 10,
  sub_min_child_size = 5,
  sub_resolution_factor = 1.3,
  sub_within_cons_max = 0.5,
  sub_conductance_min = 0.6,
  sub_improve_within_cons_min = 0.07,
  sub_max_groups = 3,
  enable_qc_filter = TRUE,
  qc_gene_intra_cons_min = 0.25,
  qc_gene_best_out_cons_min = 0.6,
  qc_gene_intra_weight_q = 0.05,
  keep_cross_stable = TRUE,
  min_cluster_size = 2,
  keep_stage1_backbone = TRUE,
  backbone_floor_q = 0.02,
  return_report = FALSE,
  verbose = TRUE,
  ncores = NULL,
  mode = c("auto", "safe", "aggressive", "fast"),
  large_n_threshold = 1000L,
  nk_condaenv = NULL,
  nk_conda_bin = NULL,
  nk_python = NULL,
  nk_leiden_iterations = 10L,
  nk_leiden_randomize = TRUE,
  aggr_future_workers = 2L,
  aggr_batch_size = NULL,
  future_globals_min_bytes = 2 * 1024^3,
  profile_timing = FALSE
)
}
\arguments{
\item{scope_obj}{A `scope_object` containing graph/stat layers.}

\item{grid_name}{Optional grid layer name; defaults to the active layer.}

\item{stats_layer}{Lee statistic layer name (overridden by `lee_stats_layer`).}

\item{lee_stats_layer}{Layer name.}

\item{similarity_slot}{Slot name holding similarity matrix (default `L`).}

\item{significance_slot}{Slot name holding significance/FDR matrix.}

\item{min_cutoff}{Minimum similarity cutoff (alias `L_min`).}

\item{L_min}{Numeric threshold.}

\item{use_significance}{Whether to apply significance/FDR gating.}

\item{use_FDR}{Logical flag.}

\item{significance_max}{Numeric threshold.}

\item{FDR_max}{Numeric threshold.}

\item{pct_min}{Numeric threshold.}

\item{drop_isolated}{Parameter value.}

\item{algo}{Clustering algorithm choice (`leiden`, `louvain`, `hotspot-like`).}

\item{stage2_algo}{Parameter value.}

\item{resolution}{Clustering resolution parameter passed to Leiden/Louvain.}

\item{gamma}{Parameter value.}

\item{objective}{Parameter value.}

\item{cluster_name}{Parameter value.}

\item{use_log1p_weight}{Logical flag.}

\item{use_consensus}{Logical flag.}

\item{graph_slot_name}{Graph slot used to drive clustering (e.g., consensus graph).}

\item{n_restart}{Parameter value.}

\item{consensus_thr}{Parameter value.}

\item{K}{Parameter value.}

\item{min_module_size}{Numeric threshold.}

\item{CI95_filter}{Parameter value.}

\item{CI_rule}{Parameter value.}

\item{curve_layer}{Layer name.}

\item{use_mh_weight}{Logical flag.}

\item{use_cmh_weight}{Logical flag.}

\item{mh_slot}{Slot name.}

\item{cmh_slot}{Slot name.}

\item{post_smooth}{Parameter value.}

\item{post_smooth_quant}{Parameter value.}

\item{post_smooth_power}{Parameter value.}

\item{enable_subcluster}{Logical flag.}

\item{sub_min_size}{Parameter value.}

\item{sub_min_child_size}{Parameter value.}

\item{sub_resolution_factor}{Parameter value.}

\item{sub_within_cons_max}{Numeric threshold.}

\item{sub_conductance_min}{Numeric threshold.}

\item{sub_improve_within_cons_min}{Numeric threshold.}

\item{sub_max_groups}{Parameter value.}

\item{enable_qc_filter}{Logical flag.}

\item{qc_gene_intra_cons_min}{Numeric threshold.}

\item{qc_gene_best_out_cons_min}{Numeric threshold.}

\item{qc_gene_intra_weight_q}{Parameter value.}

\item{keep_cross_stable}{Logical flag.}

\item{min_cluster_size}{Numeric threshold.}

\item{keep_stage1_backbone}{Logical flag.}

\item{backbone_floor_q}{Parameter value.}

\item{return_report}{When `TRUE`, returns both updated scope object and a report list.}

\item{verbose}{Logical; whether to emit progress messages.}

\item{ncores}{Number of cores/threads to use.}

\item{mode}{Parameter value.}

\item{large_n_threshold}{Parameter value.}

\item{nk_condaenv}{Parameter value.}

\item{nk_conda_bin}{Parameter value.}

\item{nk_python}{Parameter value.}

\item{nk_leiden_iterations}{Parameter value.}

\item{nk_leiden_randomize}{Parameter value.}

\item{aggr_future_workers}{Parameter value.}

\item{aggr_batch_size}{Parameter value.}

\item{future_globals_min_bytes}{Parameter value.}

\item{profile_timing}{Parameter value.}
}
\value{
Return value used internally.
}
\description{
Internal helper for `.cluster_genes`.
Runs the stage1/stage2 clustering pipeline on a scope object.
}
\keyword{internal}
