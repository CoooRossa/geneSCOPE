% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/LeesL.r
\name{.computeLeeL}
\alias{.computeLeeL}
\title{Compute Lee’s L from Pre-constructed Grid Data (No Global Shifting)}
\usage{
.computeLeeL(
  coordObj,
  grid_name = NULL,
  norm_layer = "Xz",
  genes = NULL,
  within = TRUE,
  ncore = 1,
  use_cpp = TRUE
)
}
\arguments{
\item{coordObj}{A coordObj processed through createCoordObj + countMPG + norMPG
(or equivalent layers) + computeSpatialWeights.}

\item{grid_name}{Character or NULL. The name of the grid sublayer to use (e.g., "grid_lenGrid50").
If NULL and there is only one sublayer under coordObj\$grid, that layer is used;
otherwise this must be provided explicitly.}

\item{norm_layer}{Character or NULL. The name of the normalization layer to use:
- If "Xz", reads coordObj\$grid[\link{grid_name}][\link{"Xz"}], which is already Z-score normalized
(column means ≈ 0).
- If NULL, uses the raw counts layer and applies column-centered normalization.}

\item{genes}{Character vector or NULL. If non-NULL, compute Lee’s L only for these genes:
- If within = TRUE, returns a |genes|×|genes| submatrix.
- If within = FALSE, returns a |genes|×|all genes| matrix.}

\item{within}{Logical (default TRUE):
- TRUE: compute Lee’s L within the provided genes list (|genes|×|genes|).
- FALSE: compute Lee’s L between the provided genes list and all genes (|genes|×|all genes|).}

\item{ncore}{Integer. Number of parallel cores to use when use_cpp = FALSE.}

\item{use_cpp}{Logical (default TRUE). Whether to call the C++ interface leeL_cpp for acceleration.}
}
\value{
A list containing:
\item{Lmat}{Lee’s L submatrix (if within = TRUE, a |genes|×|genes| matrix; otherwise |genes|×|all genes|).}
\item{X_used}{The subsetted matrix used for Lee’s L (rows = grid IDs; columns = selected genes).}
\item{X_full}{The full column-centered or Z-score matrix (rows = grid IDs; columns = all genes).}
\item{grid_info}{coordObj\$grid[\link{grid_name}]\$grid_info (contains each cell’s spatial boundary info).}
\item{cells}{All grid IDs (in the same order as rows of X_full).}
\item{W}{The Queen adjacency weights matrix coordObj\$grid[\link{grid_name}]\$W (|cells|×|cells|, entries 0/1).}
}
\description{
This function computes Lee’s L statistics directly using either a column-centered
or Z-score–normalized matrix without applying any “+1” or row-wise shifting. This
preserves symmetry around zero in the input data so that Lee’s L can take both
positive and negative values. Given a spatial weights matrix W, for each gene the
spatial lag vector \(\tilde{x}\emph{i = \sum_j W}{ij} x_j\) is column-centered and then
Pearson correlation is computed and multiplied by the corresponding spatial autocorrelation
coefficient, following the definition in Lee (2001).
}
