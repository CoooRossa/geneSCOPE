% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ClusterGene.r
\name{graphClusterGenes}
\alias{graphClusterGenes}
\title{Two-step gene clustering: Lee’s L macro-modules → Δ-L refined sub-modules}
\usage{
graphClusterGenes(
  coordObj,
  grid_name = NULL,
  lee_stats_layer = "LeeStats_Xz",
  delta_layer = "LeeMinusR_stats",
  L_min = 0,
  algo = "louvain",
  resolution = 1,
  pct_min = "q0",
  pct_max = "q100",
  use_delta_L = FALSE,
  delta_split_min = 0,
  delta_FDR_max = 0.05,
  split_min_size = 20,
  cluster_name = NULL,
  drop_isolated = TRUE
)
}
\arguments{
\item{lee_stats_layer}{Sub-layer that stores Lee’s L / FDR (default "LeeStats_Xz")}

\item{delta_layer}{Sub-layer that stores Δ / FDR (default "LeeMinusR_stats")}

\item{L_min}{Minimum positive Lee’s L to retain an edge}

\item{algo}{Community detection algorithm: "louvain" or "leiden"}

\item{resolution}{Resolution parameter for Louvain/Leiden}

\item{use_delta_L}{Whether to perform the Δ-L second step (default TRUE)}

\item{delta_split_min}{Minimum Δ to trigger a conflict edge}

\item{delta_FDR_max}{FDR threshold for Δ}

\item{split_min_size}{Attempt sub-splitting only if a macro module contains at least this many genes}

\item{cluster_name}{Prefix of output column; generated automatically if NULL}
}
\value{
The modified \code{coordObj}
}
\description{
\strong{Step 1 Macro modules} — keep only positive Lee’s L edges (\verb{L ≥ L_min}) and apply Louvain/Leiden to obtain macro-module IDs \emph{macro}.

\strong{Step 2 Δ-L refinement} (within each macro module)
\itemize{
\item \strong{Conflict edges} = \verb{Δ ≥ delta_split_min & FDR_Δ ≤ delta_FDR_max} \strong{or} \code{L < 0}.
\item \strong{Candidate genes} = genes incident to at least one conflict edge.
\item Non-candidate genes are labeled \code{macro.0}.
\item \strong{Glue edges} = \code{L > 0 & Δ < 0}; connected components of the glue graph define sub-modules \code{macro.1}, \code{macro.2}, …
If no glue edges exist, each candidate gene forms its own sub-module.
}

\strong{Output} (stored in \code{coordObj@meta.data})
\itemize{
\item \code{{cluster_name}}       — final module ID (macro module unless a sub-module contains >2 genes, in which case \code{macro.sub} overwrites)
\item \verb{\{cluster_name\}_sub}   — full Δ-L sub-module ID (\code{macro.sub})
}
}
