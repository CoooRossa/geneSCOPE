% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/15.DendroSubcluster.r
\name{plotDendroNetworkWithBranches}
\alias{plotDendroNetworkWithBranches}
\title{基于树形网络的分支子聚类可视化}
\usage{
plotDendroNetworkWithBranches(
  coordObj,
  grid_name = NULL,
  lee_stats_layer = "LeeStats_Xz",
  gene_subset = NULL,
  L_min = 0,
  drop_isolated = TRUE,
  use_consensus_graph = TRUE,
  graph_slot_name = "g_consensus",
  cluster_vec = NULL,
  IDelta_col_name = NULL,
  damping = 0.85,
  weight_low_cut = 0,
  cluster_palette = c("#E41A1C", "#377EB8", "#4DAF4A", "#FF7F00", "#FFFF33", "#A65628",
    "#984EA3", "#66C2A5", "#FC8D62", "#8DA0CB", "#E78AC3", "#A6D854", "#FFD92F",
    "#E5C494"),
  vertex_size = 8,
  base_edge_mult = 12,
  label_cex = 3,
  seed = 1,
  hub_factor = 3,
  length_scale = 1,
  max.overlaps = 20,
  hub_border_col = "#4B4B4B",
  hub_border_size = 0.8,
  show_sign = FALSE,
  neg_linetype = "dashed",
  neg_legend_lab = "Negative",
  pos_legend_lab = "Positive",
  show_qc_caption = TRUE,
  title = NULL,
  k_top = 1,
  tree_mode = c("rooted", "radial", "forest"),
  enable_subbranch = TRUE,
  cluster_id = NULL,
  include_root = TRUE,
  max_subclusters = 10,
  fallback_community = TRUE,
  min_sub_size = 3,
  community_method = c("louvain", "leiden"),
  subbranch_palette = c("#999999", "#D55E00", "#0072B2", "#009E73", "#CC79A7", "#F0E442",
    "#56B4E9", "#E69F00"),
  downstream_min_size = NULL,
  force_split = TRUE,
  main_fraction_cap = 0.9,
  core_periph = TRUE,
  core_degree_quantile = 0.75,
  core_min_fraction = 0.05,
  degree_gini_threshold = 0.35,
  verbose = TRUE
)
}
\arguments{
\item{coordObj}{A \code{CoordObj} containing \code{@grid} and Lee's
statistics.}

\item{grid_name}{Character. Grid sub-layer to plot. Defaults to the
first layer.}

\item{lee_stats_layer}{Name of the Lee's stats layer (default \code{"LeeStats_Xz"}).}

\item{gene_subset}{Optional character vector of genes to keep.}

\item{drop_isolated}{Logical. Discard isolated nodes.}

\item{use_consensus_graph}{Logical. Use pre-computed consensus graph stored
in \code{graph_slot_name}.}

\item{graph_slot_name}{Name under which the consensus graph is stored.}

\item{cluster_vec}{Either a named vector of cluster assignments or the
name of a column in \code{meta.data}.}

\item{IDelta_col_name}{Character. Column name in \code{meta.data} containing
Morisita's Iδ values for PageRank weighting. If \code{NULL},
no PageRank weighting is applied.}

\item{damping}{Numeric. Damping factor for PageRank algorithm (default 0.85).}

\item{weight_low_cut}{Numeric. Minimum edge weight threshold after PageRank
weighting (default 0).}

\item{cluster_palette}{Character vector of colours (named or unnamed).}

\item{vertex_size, base_edge_mult, label_cex}{Graph aesthetics.}

\item{seed}{Random seed for layout reproducibility.}

\item{hub_factor}{Degree multiplier defining "hub" nodes.}

\item{length_scale}{Global edge-length multiplier.}

\item{show_sign}{Draw negative edges with distinct linetype.}

\item{neg_linetype}{Linetype for negative edges.}

\item{title}{Optional plot title.}

\item{k_top}{Integer. Maximum number of high-weight non-tree edges
to retain between clusters (default 1).}

\item{tree_mode}{Character. Tree layout style: \code{"rooted"},
\code{"radial"}, or \code{"forest"} (default "rooted").}

\item{enable_subbranch}{是否启用分支子聚类细分 (默认 TRUE)}

\item{cluster_id}{可选字符向量：只对子聚类拆分的簇；NULL=全部}

\item{include_root}{关节点法是否把关节点包含进每个分支}

\item{max_subclusters}{每簇最多保留子聚类数 (按规模贪心去重)}

\item{fallback_community}{关节点无结果时是否回退社区}

\item{min_sub_size}{社区回退时子聚类最小规模}

\item{community_method}{社区算法优先顺序}

\item{subbranch_palette}{子聚类调色板：第1色=剩余/未细分，其余循环分配给子聚类}

\item{downstream_min_size}{下游子树判定规模阈值（NULL=自适应）}

\item{force_split}{原社区拆分失败时是否尝试放宽接受条件}

\item{main_fraction_cap}{最大社区占比阈值（超过也允许保留其余小社区）}

\item{core_periph}{允许核心-边缘拆分}

\item{core_degree_quantile}{核心度阈值分位}

\item{core_min_fraction}{核心最小占比}

\item{degree_gini_threshold}{触发核心-边缘拆分的度Gini阈值}
}
\value{
list(plot, graph, subclusters, subcluster_df, cluster_df, method_subcluster,
base_network, branch_network, params)
}
\description{
调用已有 \code{plotDendroNetwork()} 构建树状/骨架网络后，对指定簇(或全部簇)执行
“关节点分支”子聚类细分；若无候选且设置 \code{fallback_community=TRUE}，
回退 Louvain/Leiden 社区拆分。输出带子聚类着色的新网络图。
}
\examples{
\dontrun{
p <- plotDendroNetworkWithBranches(coordObj,
    grid_name = "grid_lenGrid30",
    cluster_vec = "modL0.15",
    enable_subbranch = TRUE
)
}
}
